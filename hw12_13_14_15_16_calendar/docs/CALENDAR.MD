## Техническое задание на сервис «Календарь»

### Общее описание
Сервис "Календарь" представляет собой максимально упрощенный сервис для хранения календарных событий и отправки уведомлений.

Сервис предполагает возможность:
* добавить/обновить событие;
* получить список событий на день/неделю/месяц;
* получить уведомление за N дней до события.

Сервис НЕ предполагает:
* авторизации;
* разграничения доступа;
* web-интерфейса.

### Архитектура
Полностью завершенный сервис состоит из 6 процессов.

#### 1) Реализация Rest API Календаря
API предоставляет собой RestAPI интерфейс для пользователей. API реализуют основные методы сервиса.
Так как авторизация и разделение доступа выходят за рамки сервиса, мы предполагаем, что ID пользователя
просто передается через параметры / метаданные / заголовок запроса.

#### 2) Планировщик
Планировщик - это фоновый процесс, который не взаимодействует с пользователем и выполняет периодические задания:
* выбор событий, требующих уведомления и отправка уведомлений в очередь хранителю;
* очистка старых (более 1 года назад) событий.

#### 3) Хранитель
Хранитель - это фоновый процесс, занимающийся отправкой уведомлений.

В рамках задания хранитель должен просто сохранять уведомления в базу данных.

#### 4) СУБД
Реляционная СУБД (например, PostgreSQL) - хранит информацию о событиях.

#### 5) Брокер сообщений
Брокер сообщений (Apache Kafka) - используется для передачи уведомлений от Планировщика Хранителю. 
Позволяет создавать топики, в которые пишутся уведомления, и работает с подписчиками и отправителями сообщений.

#### 6) Мониторинг
Мониторинг - это процесс, который собирает метрики о работе сервиса и отправляет их в систему мониторинга (например, Prometheus). 
В рамках этой задачи студент узнает, как работать с библиотеками для создания метрик и инструментирования своего сервиса для сбора и визуализации ключевых показателей работы.

### Описание сущностей
#### Событие
Событие - основная сущность, содержит в себе поля:
* ID - уникальный идентификатор события (можно воспользоваться UUID);
* Заголовок - короткий текст;
* Дата и время события;
* Длительность события (или дата и время окончания);
* Описание события - длинный текст, опционально;
* ID пользователя, владельца события;
* За сколько времени высылать уведомление, опционально.

#### Уведомление
Уведомление - временная сущность, в БД не хранится, складывается в очередь для хранителя, содержит поля:
* ID события;
* Заголовок события;
* Дата события;
* Пользователь, которому отправлять.

### Описание методов
* Создать (событие);
* Обновить (ID события, событие);
* Удалить (ID события);
* СписокСобытийНаДень (дата);
* СписокСобытийНаНеделю (дата начала недели);
* СписокСобытийНaМесяц (дата начала месяца).

### Конфигурация, логирование, контейнеризация
Рекомендуется собирать проект в виде трех бинарных файлов, по одному на каждый микросервис.
Каждый из сервисов должен принимать путь файлу конфигурации:
```text
./calendar           --config=/path/to/calendar_config.yaml
./calendar_scheduler --config=/path/to/scheduler_config.yaml
./calendar_storer    --config=/path/to/storer_config.yaml
```
Проект следует оформить в виде набора контейнеров для каждого из микросервисов.
Поскольку запуск будет осуществлять в контейнерах - логи нужно печатать в STDOUT.
Сервисы должны получать настройки (например, адрес и логин в СУБД) через переменные окружения.
При желании можно использовать конфиг viper, с поддержкой переменных окружения.

Развертывание микросервиса должно осуществляться командой `docker-compose up` в директории с проектом.

### Тестирование
Для проекта необходимо реализовать интеграционные тесты, т.е. тесты проверяющие работу на уровне API.
Интеграционные тесты можно создать с помощью BDD, а можно просто с помощью стандартного пакета `testing`
и запускать их в отдельном контейнере в том же compose окружении, что и остальные микросервисы.
В таком случае тесты смогут получать адрес работающего сервиса через переменные окружения, выполнять запросы к нему,
а также проверять состояние базы данных и пр.

### Этапы разработки
Разработка разделена на следующие этапы (ДЗ):
* Разрабатываем скелет сервиса: конфигурирование, работа с базой, простой web-сервер.
* Добавляем генерацию эндпойнтов RestAPI.
* Выделяем Планировщик и Хранитель. Интегрируемся с брокером сообщений Apache Kafka.
* Создаем Docker-образы, docker-compose конфигурации, пишем интеграционные тесты.
* Создаём ручку метрик и добавляем метрики в Prometheus.

Таким образом, на каждом этапе мы получаем осмысленный проект.
